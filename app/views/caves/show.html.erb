
<div class="row">
  <div class="col-md-6">
    <br>
    <div class="thumbnail">
      <%= image_tag @cafe.image.url %>
    </div>
  </div>
  <div class="col-md-6">
    <h3><%= @cafe.name %></h3>
    <p><%= @cafe.address %><br>
      <%= @cafe.city %>
      <%= @cafe.state %>
      <%= @cafe.zipcode %>
    </p>
    <!--Google Maps-->
    <iframe width="100%" height="300" frameborder="0" style="border:0"
      src="https://www.google.com/maps/embed/v1/place?q=<%=@cafe.address.parameterize%>+<%=@cafe.city%>+<%=@cafe.state%>+<%=@cafe.zipcode%>&key=AIzaSyBImOjWS34hk-HoksGRqlCuOlDUIy1vf2s" allowfullscreen>
    </iframe>
    <!--End Google Maps-->
    <br>
    <br>

    <div class=container> <!--Large container under col-md-6-->

    <p><%= @cafe.description %></p>
    <p>Owner: <%= @cafe.user.name %></p>
    <br>
    <div class="star-rating" data-score= <%= @avg_rating %> ></div>
    <p><%= "#{@reviews.length} reviews" %></p>
    <br>
    <div class = "center">
      <%= link_to "Start Session", new_cafe_session_path(@cafe), class: "btn btn-primary" %>
    </div>
  </div> <!-- END Large container under col-md-6-->
</div>
</div>

<br>

<div class=container> <!--container for reviews controls-->

  <%= link_to "Write a Review", new_cafe_review_path(@cafe), class: "btn btn-default" %>
  <%= link_to 'Back', caves_path, class: "btn btn-link" %>
  <%= link_to 'Edit', edit_cafe_path(@cafe), class: "btn btn-link", data: {no_turbolink: true} %>

  <% if (current_user == @cafe.user) %>
    <%= link_to cafe_path(@cafe), :method => :delete, :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure you want to delete this cafe?')) }, :class => 'btn btn-xs', :title => "#{ t('.destroy', :default => t('helpers.links.destroy')) }" do %>
    <%= glyph 'remove' %>
  <%- end -%>
  <%end %>

</div><!--END container for reviews controls-->

<br>
<br>

<div class=container> <!--container for reviews table-->
<div class = "row ">
<%if @reviews.blank? %>
  <h3> No reviews yet. Be the first to write one!</h3>
<%else%>

<table class="table">
  <thead>
    <tr>
      <th class="col-md-3"></th>
      <th class="col-md-9"></th>
    </tr>
  </thead>
  <tbody>
    <% @reviews.each do |review| %>
      <tr>
        <td>
          <h4>
              <%= "#{review.user.name}" %>
          </h4>
              <p><%= review.created_at.strftime("%-m/%-d/%-y") %></p>
              <% if user_signed_in? %>
                <% if (review.user == current_user) %>
                  <%= link_to "Edit", edit_cafe_review_path(@cafe, review) %>
                  <%= link_to "Delete", cafe_review_path(@cafe, review), method: :delete %>
                <% end %>
              <% end %>
          </td>
        <td>
        <div class = "panel panel-default form-style">
          <div class="star-rating" data-score= <%= review.rating %> ></div>
          <p><%= h(review.comment).gsub(/\n/, '<br/>').html_safe %></p>
        </div>
      </td>
    </tr>
  <% end %>
</table>
<%end%>
</div>

</div><!--END Large container for reviews table-->



<script>
  $('.star-rating').raty({
    path: '/images/ratyrate',
    readOnly: true,
    score: function() {
      return $(this).attr('data-score');
    }
  });
</script>
